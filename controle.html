<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Gastos Ninja 4.0</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #4CAF50;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .display-box, .input-box, button {
            font-size: 1em;
            color: #333;
            margin: 8px 0;
            padding: 8px;
            border-radius: 6px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            border: 1px solid #ccc;
        }
        .input-box {
            background-color: white;
        }
        #baseMonthlyDisplay, #benefitsDisplay, #availableFundsBase, #availableFundsBenefits, #baseDailyDisplay, #benefitsDailyDisplay, #baseMinuteDisplay, #benefitsMinuteDisplay {
            background-color: #e1f5fe;
        }
        #benefitsExpenseInput {
            background-color: #ffe0b2;
        }
        #savingsGoalInput, #savingsTimeDisplay {
            background-color: #e0e0e0;
        }
        #revenueInput {
            background-color: #c8e6c9;
        }
        #expenseInput {
            background-color: #ffcdd2;
        }
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .expense-btn { background-color: #f44336; }
        .reset-btn { background-color: #2196F3; }
        .expense-btn[onclick="subtractBenefitExpense()"] {
            background-color: orange;
        }
        .negative {
            color: red;
        }
        .positive {
            color: green;
        }
        .input-row, .display-row {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 500px;
            margin: 8px auto;
        }
        .input-row .input-box, .display-row .display-box {
            width: 48%;
        }
        table {
            width: 90%;
            max-width: 500px;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .gain {
            color: green;
        }
        .expense {
            color: red;
        }
        #lockButton {
            background-color: #888;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Controle Gastos Ninja 3.0</h1>
    
    <div class="container">
        <button id="lockButton" onclick="toggleLock()">üîí Bloquear Edi√ß√£o</button>
        <div class="input-row">
            <input type="number" id="baseMonthlyInput" class="input-box" placeholder="Base Mensal" oninput="setBaseMonthlyValue()">
            <input type="number" id="benefitsInput" class="input-box" placeholder="Outros Benef√≠cios" oninput="setBaseMonthlyValue()">
        </div>
        
        <div class="display-row">
            <div id="baseMonthlyDisplay" class="display-box"></div>
            <div id="benefitsDisplay" class="display-box"></div>
        </div>
        
        <div class="display-row">
            <div id="availableFundsBase" class="display-box"></div>
            <div id="availableFundsBenefits" class="display-box"></div>
        </div>

        <div class="display-row">
            <div id="baseDailyDisplay" class="display-box"></div>
            <div id="benefitsDailyDisplay" class="display-box"></div>
        </div>

        <div class="display-row">
            <div id="baseMinuteDisplay" class="display-box"></div>
            <div id="benefitsMinuteDisplay" class="display-box"></div>
        </div>

        <div class="input-row">
            <input type="number" id="expenseInput" class="input-box" placeholder="Valor do Gasto">
            <input type="number" id="revenueInput" class="input-box" placeholder="Valor do Ganho">
        </div>
        <div class="input-row">
            <button class="expense-btn" onclick="addTransaction('expense')">Adicionar Gasto</button>
            <button class="revenue-btn" onclick="addTransaction('revenue')">Adicionar Ganho</button>
        </div>

        <input type="number" id="benefitsExpenseInput" class="input-box" placeholder="Gasto com Benef√≠cios">
        <button class="expense-btn" onclick="subtractBenefitExpense()">Adicionar Desconto Benef√≠cio</button>
        
        <input type="number" id="savingsGoalInput" class="input-box" placeholder="Valor que deseja acumular" oninput="calculateTimeToSave()">
        <div id="savingsTimeDisplay" class="display-box"></div>
        
        <div class="button-container">
            <button class="reset-btn" onclick="resetMonth()">Resetar (iniciar novo m√™s)</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Data/Hora</th>
                    <th>Tipo</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody id="transactionTableBody">
            </tbody>
        </table>
    </div>
    
    <script>
        let baseMonthlyValue = parseFloat(localStorage.getItem("baseMonthlyValue")) || 3500;
        let benefitsValue = parseFloat(localStorage.getItem("benefitsValue")) || 1000;
        let accumulatedBase = parseFloat(localStorage.getItem("accumulatedBase")) || 0;
        let accumulatedBenefits = parseFloat(localStorage.getItem("accumulatedBenefits")) || 0;
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
        let locked = false;
        let baseMinuteValue = 0;
        let benefitsMinuteValue = 0;

        function saveData() {
            localStorage.setItem("baseMonthlyValue", baseMonthlyValue);
            localStorage.setItem("benefitsValue", benefitsValue);
            localStorage.setItem("accumulatedBase", accumulatedBase);
            localStorage.setItem("accumulatedBenefits", accumulatedBenefits);
            localStorage.setItem("transactions", JSON.stringify(transactions));
        }

        function calculateMinuteValues() {
            const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            const minutesInMonth = daysInMonth * 24 * 60;
            baseMinuteValue = baseMonthlyValue / minutesInMonth;
            benefitsMinuteValue = benefitsValue / minutesInMonth;
        }

        function getIncrementPerMinute(value) {
            return value / (30 * 24 * 60);
        }

        function setBaseMonthlyValue() {
            if (locked) return;
            baseMonthlyValue = parseFloat(document.getElementById("baseMonthlyInput").value) || 0;
            benefitsValue = parseFloat(document.getElementById("benefitsInput").value) || 1000;
            accumulatedBase = 0;
            accumulatedBenefits = 0;
            calculateMinuteValues();
            saveData();
            updateDisplay();
        }

        function subtractBenefitExpense() {
            let expense = parseFloat(document.getElementById("benefitsExpenseInput").value) || 0;
            if (expense > accumulatedBenefits) {
                alert("Saldo insuficiente nos benef√≠cios.");
                return;
            }
            accumulatedBenefits -= expense;
            benefitsValue -= expense; // Subtrai o gasto dos benef√≠cios
            saveData();
            updateDisplay();
        }

        function addTransaction(type) {
            let inputId = (type === 'revenue') ? "revenueInput" : "expenseInput";
            let input = document.getElementById(inputId);
            let value = parseFloat(input.value) || 0;
            
            if (value === 0) {
                alert("Por favor, insira um valor v√°lido.");
                return;
            }
            
            if (type === 'expense') {
                accumulatedBase -= value;
                baseMonthlyValue -= value;
            } else {
                accumulatedBase += value;
                baseMonthlyValue += value;
            }
            
            transactions.push({
                date: new Date().toLocaleString(),
                type: type === 'expense' ? 'Gasto' : 'Ganho',
                value: value
            });
            
            saveData();
            updateDisplay();
            input.value = "";
            renderTransactionTable();
        }

        function accumulateAutoGain() {
            let baseGain = baseMinuteValue;
            let benefitsGain = benefitsMinuteValue;

            accumulatedBase += baseGain;
            accumulatedBenefits += benefitsGain;
            baseMonthlyValue -= baseGain;
            benefitsValue -= benefitsGain;
            saveData();
            updateDisplay();
        }

        function calculateTimeToSave() {
            let goal = parseFloat(document.getElementById("savingsGoalInput").value) || 0;
            let gainPerMinute = baseMinuteValue;
            let timeRequired = goal / gainPerMinute;
            let hours = Math.floor(timeRequired / 60);
            let minutes = Math.floor(timeRequired % 60);
            document.getElementById("savingsTimeDisplay").innerText = `Tempo estimado para acumular: ${hours}h ${minutes}m`;
        }

        function resetMonth() {
            baseMonthlyValue = 3500;
            benefitsValue = 1000;
            accumulatedBase = 0;
            accumulatedBenefits = 0;
            transactions = [];
            calculateMinuteValues();
            saveData();
            updateDisplay();
            renderTransactionTable();
        }

        function updateDisplay() {
            document.getElementById("baseMonthlyDisplay").innerText = `Base Mensal: R$ ${baseMonthlyValue.toFixed(2)}`;
            document.getElementById("benefitsDisplay").innerText = `Benef√≠cios: R$ ${benefitsValue.toFixed(2)}`;
            document.getElementById("availableFundsBase").innerText = `Dispon√≠vel Mensal: R$ ${accumulatedBase.toFixed(2)}`;
            document.getElementById("availableFundsBenefits").innerText = `Dispon√≠vel Benef√≠cio: R$ ${accumulatedBenefits.toFixed(2)}`;

            let daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            document.getElementById("baseDailyDisplay").innerText = `Base Mensal Di√°rio: R$ ${(baseMonthlyValue / daysInMonth).toFixed(2)}`;
            document.getElementById("benefitsDailyDisplay").innerText = `Benef√≠cio Di√°rio: R$ ${(benefitsValue / daysInMonth).toFixed(2)}`;
            document.getElementById("baseMinuteDisplay").innerText = `Base por Minuto: R$ ${baseMinuteValue.toFixed(4)}`;
            document.getElementById("benefitsMinuteDisplay").innerText = `Benef√≠cio por Minuto: R$ ${benefitsMinuteValue.toFixed(4)}`;

            if (accumulatedBase < 0) {
                document.getElementById("availableFundsBase").classList.add('negative');
                document.getElementById("availableFundsBase").classList.remove('positive');
            } else if (accumulatedBase > 0){
                document.getElementById("availableFundsBase").classList.add('positive');
                document.getElementById("availableFundsBase").classList.remove('negative');
            } else {
                document.getElementById("availableFundsBase").classList.remove('negative');
                document.getElementById("availableFundsBase").classList.remove('positive');
            }
        }
        
        function renderTransactionTable() {
            const tableBody = document.getElementById("transactionTableBody");
            tableBody.innerHTML = '';
            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                let valueText = `R$ ${transaction.value.toFixed(2)}`;
                let valueClass = 'gain';
                
                if (transaction.type === 'Gasto') {
                    valueText = `-R$ ${transaction.value.toFixed(2)}`;
                    valueClass = 'expense';
                }
                
                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.type}</td>
                    <td class="${valueClass}">${valueText}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function toggleLock() {
            locked = !locked;
            const lockButton = document.getElementById('lockButton');
            if (locked) {
                lockButton.innerText = 'üîì Desbloquear Edi√ß√£o';
                lockButton.style.backgroundColor = '#4CAF50';
            } else {
                lockButton.innerText = 'üîí Bloquear Edi√ß√£o';
                lockButton.style.backgroundColor = '#888';
            }
        }

        window.onload = function() {
            calculateMinuteValues();
            updateDisplay();
            renderTransactionTable();
            setInterval(accumulateAutoGain, 60000);
        };
    </script>
</body>
</html>
