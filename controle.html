<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Gastos Ninja 3.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #4CAF50;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .display-box, .input-box, button {
            font-size: 1em;
            color: #333;
            margin: 8px 0;
            padding: 8px;
            border-radius: 6px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            border: 1px solid #ccc;
        }
        .input-box {
            background-color: white;
        }
        #baseMonthlyDisplay, #benefitsDisplay, #availableFundsBase, #availableFundsBenefits, #baseDailyDisplay, #benefitsDailyDisplay, #baseMinuteDisplay, #benefitsMinuteDisplay, #savingsTimeDisplay {
            background-color: #e1f5fe;
        }
        #benefitsExpenseInput {
            background-color: #ffe0b2;
        }
        #savingsGoalInput {
            background-color: #e0e0e0;
        }
        #revenueInput {
            background-color: #c8e6c9;
        }
        #expenseInput {
            background-color: #ffcdd2;
        }
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .expense-btn { background-color: #f44336; }
        .reset-btn { background-color: #2196F3; }
        .expense-btn[onclick="subtractBenefitExpense()"] {
            background-color: orange;
        }
        .negative {
            color: red;
        }
        .positive {
            color: green;
        }
        .input-row, .display-row {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 500px;
            margin: 8px auto;
        }
        .input-row .input-box, .display-row .display-box {
            width: 48%;
        }
        table {
            width: 90%;
            max-width: 500px;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .gain {
            color: green;
        }
        .expense {
            color: red;
        }
        #lockButton {
            background-color: #888;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
        }

        /* Estilos para os gr√°ficos */
        .chart-container {
            width: 90%;
            max-width: 500px;
            margin: 20px auto;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            background-color: white;
            position: relative; /* Para posicionar o bot√£o de maximizar */
        }
        .chart-container canvas {
            width: 100%;
            height: 100%;
            display: block; /* Garante que o canvas se ajuste ao container */
        }

        .chart-container.minimized {
            height: 50px; /* Altura m√≠nima quando minimizado */
            overflow: hidden;
        }

        .chart-container.minimized canvas {
            display: none;
        }

        .chart-container button.maximize-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 255, 255, 0.7); /* Fundo semi-transparente */
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            font-size: 0.8em;
            display: block; /* Mostrar o bot√£o */
            z-index: 10;
        }

        .chart-container.minimized button.maximize-btn {
            display: block;
        }

        #goalProgress {
            display: none;
            width: 90%;
            max-width: 500px;
            margin: 20px auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #e0e0e0;
            text-align: center;
        }

        #goalProgress .progress-bar {
            background-color: #4CAF50;
            height: 10px;
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <h1>Controle Gastos Ninja 3.0</h1>
    
    <div class="container">
        <button id="lockButton" onclick="toggleLock()">üîí Bloquear Edi√ß√£o</button>
        <div class="input-row">
            <input type="number" id="baseMonthlyInput" class="input-box" placeholder="Base Mensal" oninput="setBaseMonthlyValue()">
            <input type="number" id="benefitsInput" class="input-box" placeholder="Outros Benef√≠cios" oninput="setBaseMonthlyValue()">
        </div>
        
        <div class="display-row">
            <div id="baseMonthlyDisplay" class="display-box"></div>
            <div id="benefitsDisplay" class="display-box"></div>
        </div>
        
        <div class="display-row">
            <div id="availableFundsBase" class="display-box"></div>
            <div id="availableFundsBenefits" class="display-box"></div>
        </div>

        <div class="display-row">
            <div id="baseDailyDisplay" class="display-box"></div>
            <div id="benefitsDailyDisplay" class="display-box"></div>
        </div>

        <div class="display-row">
            <div id="baseMinuteDisplay" class="display-box"></div>
            <div id="benefitsMinuteDisplay" class="display-box"></div>
        </div>

        <div class="input-row">
            <input type="number" id="expenseInput" class="input-box" placeholder="Valor do Gasto">
            <input type="number" id="revenueInput" class="input-box" placeholder="Valor do Ganho">
        </div>
        <div class="input-row">
            <button class="expense-btn" onclick="addTransaction('expense')">Adicionar Gasto</button>
            <button class="revenue-btn" onclick="addTransaction('revenue')">Adicionar Ganho</button>
        </div>

        <input type="number" id="benefitsExpenseInput" class="input-box" placeholder="Gasto com Benef√≠cios">
        <button class="expense-btn" onclick="subtractBenefitExpense()">Adicionar Desconto Benef√≠cio</button>
        
        <input type="number" id="savingsGoalInput" class="input-box" placeholder="Valor que deseja acumular" oninput="calculateTimeToSave()">
        <div id="savingsTimeDisplay" class="display-box"></div>
        
        <div class="button-container">
            <button class="reset-btn" onclick="resetMonth()">Resetar (iniciar novo m√™s)</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Data/Hora</th>
                    <th>Tipo</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody id="transactionTableBody">
            </tbody>
        </table>

        <div class="chart-container" id="dailyBarChartContainer">
            <canvas id="dailyBarChart"></canvas>
            <button class="maximize-btn" onclick="toggleMaximizeChart('dailyBarChartContainer')">Maximizar</button>
        </div>
    </div>
    
    <script>
        let baseMonthlyValue = parseFloat(localStorage.getItem("baseMonthlyValue")) || 3500;
        let benefitsValue = parseFloat(localStorage.getItem("benefitsValue")) || 1000;
        let accumulatedBase = parseFloat(localStorage.getItem("accumulatedBase")) || 0;
        let accumulatedBenefits = parseFloat(localStorage.getItem("accumulatedBenefits")) || 0;
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
        let locked = false;
        let baseMinuteValue = 0;
        let benefitsMinuteValue = 0;
        let savingsGoal = 0;
        let chartInstances = {}; // Para armazenar inst√¢ncias de gr√°ficos

        function saveData() {
            localStorage.setItem("baseMonthlyValue", baseMonthlyValue);
            localStorage.setItem("benefitsValue", benefitsValue);
            localStorage.setItem("accumulatedBase", accumulatedBase);
            localStorage.setItem("accumulatedBenefits", accumulatedBenefits);
            localStorage.setItem("transactions", JSON.stringify(transactions));
             localStorage.setItem("savingsGoal", savingsGoal);
        }

        function calculateMinuteValues() {
            const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            const minutesInMonth = daysInMonth * 24 * 60;
            baseMinuteValue = baseMonthlyValue / minutesInMonth;
            benefitsMinuteValue = benefitsValue / minutesInMonth;
        }

        function getIncrementPerMinute(value) {
            return value / (30 * 24 * 60);
        }

        function setBaseMonthlyValue() {
            if (locked) return;
            baseMonthlyValue = parseFloat(document.getElementById("baseMonthlyInput").value) || 0;
            benefitsValue = parseFloat(document.getElementById("benefitsInput").value) || 1000;
            accumulatedBase = 0;
            accumulatedBenefits = 0;
            calculateMinuteValues();
            saveData();
            updateDisplay();
            updateDailyBarChart();
        }

        function subtractBenefitExpense() {
            let expense = parseFloat(document.getElementById("benefitsExpenseInput").value) || 0;
            if (expense > accumulatedBenefits) {
                alert("Saldo insuficiente nos benef√≠cios.");
                return;
            }
            accumulatedBenefits -= expense;
            benefitsValue -= expense;
            saveData();
            updateDisplay();
            updateDailyBarChart();
        }

        function addTransaction(type) {
            let inputId = (type === 'revenue') ? "revenueInput" : "expenseInput";
            let input = document.getElementById(inputId);
            let value = parseFloat(input.value) || 0;
            
            if (value === 0) {
                alert("Por favor, insira um valor v√°lido.");
                return;
            }
            
            if (type === 'expense') {
                accumulatedBase -= value;
                baseMonthlyValue -= value;
            } else {
                accumulatedBase += value;
                baseMonthlyValue += value;
            }
            
            transactions.push({
                date: new Date().toLocaleString(),
                type: type === 'expense' ? 'Gasto' : 'Ganho',
                value: value
            });
            
            saveData();
            updateDisplay();
            input.value = "";
            renderTransactionTable();
            updateDailyBarChart();
        }

        function accumulateAutoGain() {
            let baseGain = baseMinuteValue;
            let benefitsGain = benefitsMinuteValue;

            accumulatedBase += baseGain;
            accumulatedBenefits += benefitsGain;
            baseMonthlyValue -= baseGain;
            benefitsValue -= benefitsGain;
            saveData();
            updateDisplay();
            updateDailyBarChart();
        }

        function calculateTimeToSave() {
            savingsGoal = parseFloat(document.getElementById("savingsGoalInput").value) || 0;
            let gainPerMinute = baseMinuteValue;
            let timeRequired = savingsGoal / gainPerMinute;
            let hours = Math.floor(timeRequired / 60);
            let minutes = Math.floor(timeRequired % 60);
            document.getElementById("savingsTimeDisplay").innerText = `Tempo estimado para acumular: ${hours}h ${minutes}m`;
            saveData();
        }

        function resetMonth() {
            baseMonthlyValue = 3500;
            benefitsValue = 1000;
            accumulatedBase = 0;
            accumulatedBenefits = 0;
            transactions = [];
            savingsGoal = 0;
            calculateMinuteValues();
            saveData();
            updateDisplay();
            renderTransactionTable();
            updateDailyBarChart();
        }

        function updateDisplay() {
            document.getElementById("baseMonthlyDisplay").innerText = `Base Mensal: R$ ${baseMonthlyValue.toFixed(2)}`;
            document.getElementById("benefitsDisplay").innerText = `Benef√≠cios: R$ ${benefitsValue.toFixed(2)}`;
            document.getElementById("availableFundsBase").innerText = `Dispon√≠vel Mensal: R$ ${accumulatedBase.toFixed(2)}`;
            document.getElementById("availableFundsBenefits").innerText = `Dispon√≠vel Benef√≠cio: R$ ${accumulatedBenefits.toFixed(2)}`;

            let daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            document.getElementById("baseDailyDisplay").innerText = `Base Mensal Di√°rio: R$ ${(baseMonthlyValue / daysInMonth).toFixed(2)}`;
            document.getElementById("benefitsDailyDisplay").innerText = `Benef√≠cio Di√°rio: R$ ${(benefitsValue / daysInMonth).toFixed(2)}`;
            document.getElementById("baseMinuteDisplay").innerText = `Base por Minuto: R$ ${baseMinuteValue.toFixed(4)}`;
            document.getElementById("benefitsMinuteDisplay").innerText = `Benef√≠cio por Minuto: R$ ${benefitsMinuteValue.toFixed(4)}`;

            if (accumulatedBase < 0) {
                document.getElementById("availableFundsBase").classList.add('negative');
                document.getElementById("availableFundsBase").classList.remove('positive');
            } else if (accumulatedBase > 0){
                document.getElementById("availableFundsBase").classList.add('positive');
                document.getElementById("availableFundsBase").classList.remove('negative');
            } else {
                document.getElementById("availableFundsBase").classList.remove('negative');
                document.getElementById("availableFundsBase").classList.remove('positive');
            }
        }
        
        function renderTransactionTable() {
            const tableBody = document.getElementById("transactionTableBody");
            tableBody.innerHTML = '';
            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                let valueText = `R$ ${transaction.value.toFixed(2)}`;
                let valueClass = 'gain';
                
                if (transaction.type === 'Gasto') {
                    valueText = `-R$ ${transaction.value.toFixed(2)}`;
                    valueClass = 'expense';
                }
                
                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.type}</td>
                    <td class="${valueClass}">${valueText}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function toggleLock() {
            locked = !locked;
            const lockButton = document.getElementById('lockButton');
            if (locked) {
                lockButton.innerText = 'üîì Desbloquear Edi√ß√£o';
                lockButton.style.backgroundColor = '#4CAF50';
            } else {
                lockButton.innerText = 'üîí Bloquear Edi√ß√£o';
                lockButton.style.backgroundColor = '#888';
            }
        }

        function toggleMaximizeChart(chartId) {
            const chartContainer = document.getElementById(chartId);
            chartContainer.classList.toggle('minimized');
            const maximizeButton = chartContainer.querySelector('.maximize-btn');
             if (chartContainer.classList.contains('minimized')) {
                maximizeButton.innerText = 'Maximizar';
            } else {
                maximizeButton.innerText = 'Minimizar';
            }
            if (chartInstances[chartId]) {
                chartInstances[chartId].resize();
            }
        }

        function updateDailyBarChart() {
            const ctx = document.getElementById('dailyBarChart').getContext('2d');
        
            // Fun√ß√£o para gerar um array com os dias do m√™s
            function getDiasDoMes() {
                const data = new Date();
                const ultimoDia = new Date(data.getFullYear(), data.getMonth() + 1, 0).getDate();
                const dias = [];
                for (let i = 1; i <= ultimoDia; i++) {
                    dias.push(i + ' do ' + data.toLocaleString('default', { month: 'long' }));
                }
                return dias;
            }
        
            const diasDoMes = getDiasDoMes();
            const ganhosDiarios = Array(diasDoMes.length).fill(0); // Inicializa array de ganhos di√°rios
            const gastosDiarios = Array(diasDoMes.length).fill(0); // Inicializa array de gastos di√°rios
        
            // Supondo que voc√™ tenha um array 'transacoes' com seus dados
            // Exemplo de transa√ß√£o: { data: '05/10/2024', tipo: 'Ganho', valor: 50 }
            transactions.forEach(transaction => {
                const dataTransacao = new Date(transaction.date);
                const dia = dataTransacao.getDate();
                const mes = dataTransacao.getMonth();
                const ano = dataTransacao.getFullYear();
                
                // Verifica se a transa√ß√£o √© do m√™s e ano atual
                if (mes === new Date().getMonth() && ano === new Date().getFullYear()) {
                    if (transaction.type === 'Ganho') {
                        ganhosDiarios[dia - 1] += transaction.value;
                    } else if (transaction.type === 'Gasto') {
                        gastosDiarios[dia - 1] += transaction.value;
                    }
                }
            });
        
            if (chartInstances['dailyBarChart']) {
                chartInstances['dailyBarChart'].destroy();
            }
            chartInstances['dailyBarChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: diasDoMes,
                    datasets: [{
                        label: 'Ganhos',
                        data: ganhosDiarios,
                        backgroundColor: 'rgba(75, 192, 192, 0.7)', // Cor verde para ganhos
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Gastos',
                        data: gastosDiarios,
                        backgroundColor: 'rgba(255, 99, 132, 0.7)', // Cor vermelha para gastos
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    title: {
                        display: true,
                        text: 'Ganhos e Gastos Di√°rios do M√™s',
                        font: {
                            size: 16
                        }
                    },
                    legend: {
                        position: 'bottom'
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true // Come√ßa o eixo Y do zero
                            }
                        }]
                    }
                }
            });
        }


        window.onload = function() {
            calculateMinuteValues();
            updateDisplay();
            renderTransactionTable();
            updateDailyBarChart();
            setInterval(accumulateAutoGain, 60000);
        };
    </script>
</body>
</html>
